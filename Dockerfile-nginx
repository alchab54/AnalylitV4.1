# Dockerfile-nginx

# --- Etape 1: Build (si vous aviez un build frontend) ---
# FROM node:18-alpine as builder
# WORKDIR /app
# COPY web/package.json web/package-lock.json ./
# RUN npm install
# COPY web/ .
# RUN npm run build

# --- Etape 2: Production ---
FROM nginx:1.25-alpine as final

# Copie la configuration (garde les proxys /api/ et /socket.io/)
COPY nginx_complete.conf /etc/nginx/conf.d/default.conf

# Copie le frontend SPA (index.html, app.js, style.css, assets)
# Si vous aviez un build, ce serait : COPY --from=builder /app/dist /usr/share/nginx/html/
COPY web/ /usr/share/nginx/html/

# Santé optionnelle (curl présent dans l'image de base alpine nginx)
HEALTHCHECK --interval=30s --timeout=5s --retries=3 CMD wget -qO- http://localhost/ >/dev/null 2>&1 || exit 1