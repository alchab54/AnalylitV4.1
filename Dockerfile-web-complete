# Dockerfile-web-complete OPTIMISÉ
# Utilise l'image de base où tout est déjà installé (dépendances + code source)
FROM analylit-base:latest

# CORRECTION: Installe les outils réseau (netcat) nécessaires pour le script d'attente.
# On repasse temporairement en root pour l'installation.
USER root
RUN apt-get update && apt-get install -y netcat-openbsd postgresql-client && \
    rm -rf /var/lib/apt/lists/*

# On revient à l'utilisateur non-privilégié pour la sécurité.
USER appuser

# AJOUT: Copie du script d'entrée
COPY --chown=appuser:appuser entrypoint.sh /home/appuser/app/entrypoint.sh
RUN chmod +x /home/appuser/app/entrypoint.sh

# PLUS BESOIN de copier le code source - il est déjà dans l'image de base !
# L'ancienne ligne "COPY --chown=appuser:appuser . ." était redondante

# Le code source et les dépendances sont déjà présents via analylit-base:latest
# WORKDIR est déjà défini à /home/appuser/app
# USER est déjà défini à appuser
# PATH est déjà configuré pour l'environnement virtuel

EXPOSE 5001