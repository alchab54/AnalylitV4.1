# === VERSION FINALE ET INFALLIBLE (avec correction curl) ===
FROM ollama/ollama:latest

# Installer curl pour les v√©rifications de sant√©
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

# Cr√©er le script d'entr√©e DIRECTEMENT dans l'image
RUN echo '#!/bin/sh\n\
echo "üöÄ Starting Ollama server in background..."\n\
ollama serve &\n\
pid=$!\n\
echo "‚è≥ Waiting for Ollama server to be ready..."\n\
until curl -s http://127.0.0.1:11434/ > /dev/null; do\n\
  echo "   Ollama server not ready yet, waiting 2 seconds..."\n\
  sleep 2\n\
done\n\
echo "‚úÖ Ollama server is ready. Downloading models for ATN analysis..."\n\
ollama pull phi3:mini\n\
echo "   ‚úÖ phi3:mini downloaded and ready."\n\
ollama pull llama3:8b\n\
echo "   ‚úÖ llama3:8b downloaded and ready."\n\
echo "üéØ Ollama is fully configured and ready for AnalyLit ATN analysis!"\n\
echo "üèÜ Your thesis research system is VICTORY!"\n\
wait $pid' > /entrypoint.sh && chmod +x /entrypoint.sh

# D√©finir le point d'entr√©e
ENTRYPOINT ["/entrypoint.sh"]
