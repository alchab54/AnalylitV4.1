# docker/Dockerfile.web

# Image applicative - hérite de la base avec les dépendances
FROM analylit-base-cpu:latest

# Copier le code de l'application.
COPY . .

# --- Correction des permissions et des fins de ligne ---
# 1. Basculer temporairement vers l'utilisateur root.
USER root

# 2. Corriger les fins de ligne Windows (\r) et rendre le script exécutable.
RUN tr -d '\r' < scripts/entrypoint.sh > /tmp/entrypoint-fixed.sh && \
    chmod +x /tmp/entrypoint-fixed.sh && \
    mv /tmp/entrypoint-fixed.sh scripts/entrypoint.sh

# 3. Revenir à l'utilisateur non-root et s'assurer qu'il est propriétaire des fichiers.
RUN chown -R appuser:appuser /home/appuser/app
USER appuser

ENTRYPOINT ["./scripts/entrypoint.sh"]
