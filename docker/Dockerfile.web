# Image applicative - hérite de la base avec les dépendances
FROM analylit-base:latest

# Copier le code de l'application
COPY --chown=appuser:appuser backend/ backend/ scripts/ scripts/ api/ api/ utils/ utils/ web/ web/ migrations/ migrations/ ./
COPY --chown=appuser:appuser alembic.ini ./ # Fichier de configuration Alembic

# Corrige les fins de ligne Windows (\r) et rend le script exécutable
RUN tr -d '\r' < entrypoint.sh > entrypoint-fixed.sh && \
    rm entrypoint.sh && \
    mv entrypoint-fixed.sh entrypoint.sh && \
    chmod +x entrypoint.sh

ENTRYPOINT ["./entrypoint.sh"]
