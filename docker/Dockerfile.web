# Image applicative - hérite de la base avec les dépendances
FROM analylit-base:latest

# Copier tout le code de l'application en une seule commande pour plus de clarté et de robustesse.
# La destination doit se terminer par un / pour garantir que c'est bien un répertoire.
COPY --chown=appuser:appuser backend/ scripts/ api/ utils/ web/ migrations/ alembic.ini ./

# Corrige les fins de ligne Windows (\r) et rend le script exécutable
RUN tr -d '\r' < entrypoint.sh > entrypoint-fixed.sh && \
    rm entrypoint.sh && \
    mv entrypoint-fixed.sh entrypoint.sh && \
    chmod +x entrypoint.sh

ENTRYPOINT ["./entrypoint.sh"]
