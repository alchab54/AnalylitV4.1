# Image applicative - hérite de la base avec les dépendances
FROM analylit-base:latest

# ✅ CORRECTION: Copier les dossiers entiers au lieu de fichiers spécifiques.
# Cela résout le "ModuleNotFoundError: No module named 'backend'".
COPY --chown=appuser:appuser backend/ backend/
COPY --chown=appuser:appuser scripts/ scripts/
COPY --chown=appuser:appuser api/ api/
COPY --chown=appuser:appuser utils/ utils/
COPY --chown=appuser:appuser web/ web/
COPY --chown=appuser:appuser migrations/ migrations/
COPY --chown=appuser:appuser scripts/entrypoint.sh ./

# ✅ CORRECTION: Copier le fichier alembic.ini manquant dans l'image.
COPY --chown=appuser:appuser alembic.ini ./

RUN chmod +x entrypoint.sh

ENTRYPOINT ["./entrypoint.sh"]
