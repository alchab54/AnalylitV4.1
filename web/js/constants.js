// web/js/constants.js

// S√©lecteurs DOM centralis√©s
export const SELECTORS = {
    sections: '.section',
    navButtons: '.app-nav__button',
    connectionStatus: '[data-connection-status]',
    projectsList: '#projectsList',
    createProjectBtn: '#createProjectBtn',
    projectDetail: '#projectDetail',
    projectDetailContent: '#projectDetailContent',
    projectPlaceholder: '#projectPlaceholder',
    resultsContainer: '#resultsContainer',
    validationContainer: '#validationContainer',
    analysisContainer: '#analysisContainer',
    importContainer: '#importContainer',
    chatContainer: '#chatContainer',
    settingsContainer: '#settingsContainer',
    robContainer: '#robContainer',
    modalsContainer: '#modalsContainer',
    loadingOverlay: '#loadingOverlay',
    toastContainer: '#toastContainer',
    reportingContainer: '#reportingContainer',
    tasksContainer: '#tasksContainer',
    newProjectForm: '#newProjectForm',
    gridsContainer: '#gridsContainer',
    searchContainer: '#searchContainer',
    selectedArticles: '.article-checkbox:checked',
    analysisProgress: '#analysis-progress',
    analysisResults: '#analysis-results',
    settingsForm: '#profile-edit-form',
    ollamaModels: '#ollama-models-select',
    sidebar: '#sidebar',
    mainContent: '#main-content',
    loadingSpinner: '#loading-spinner',
    gridFieldDesc: '.grid-field-desc',
    zoteroFileInput: '#zoteroFileInput',
    bulkPDFInput: '#bulkPDFInput',
    pmidList: '#pmid-list',
    zoteroUserId: '#zoteroUserId',
    zoteroApiKey: '#zoteroApiKey',
    chatInput: '#chatInput',
    chatMessages: '#chatMessages'
};

// URLs API centralis√©es
export const API_ENDPOINTS = {
    // Projects
    projects: '/projects',
    projectById: (id) => `/projects/${id}`,
    projectExport: (id) => `/projects/${id}/export`,
    projectPrismaChecklist: (id) => `/projects/${id}/prisma-checklist`,
    projectRunAnalysis: (id) => `/projects/${id}/run-analysis`,
    projectExportAnalyses: (id) => `/projects/${id}/export/analyses`,
    projectExportThesis: (id) => `/projects/${id}/export/thesis`,
    
    // Grids
    grids: (projectId) => `/projects/${projectId}/grids`,
    gridById: (projectId, gridId) => `/projects/${projectId}/grids/${gridId}`,
    gridImport: (projectId) => `/projects/${projectId}/grids/import`,

    // Articles
    articlesBatchDelete: '/articles/batch-delete',
    projectSearchResults: (id) => `/projects/${id}/search-results`,
    
    // Analyses
    projectExtractions: (id) => `/projects/${id}/extractions`,
    projectRun: (id) => `/projects/${id}/run`,
    
    // Settings
    analysisProfiles: '/analysis-profiles',
    analysisProfileById: (id) => `/analysis-profiles/${id}`,
    prompts: '/prompts',
    promptById: (id) => `/prompts/${id}`,
    
    // Queues
    queuesInfo: '/queues/info',
    queuesClear: '/queues/clear',

    // Databases
    databases: '/databases',

    // Tasks
    taskCancel: (id) => `/tasks/${id}/cancel`,
    taskRetry: (id) => `/tasks/${id}/retry`,
    tasksStatus: '/tasks/status',

    // Search
    search: '/search',

    // Ollama
    ollamaPull: '/ollama/pull',
    ollamaModels: '/ollama/models',

    // Import
    projectBulkPdfDownload: (id) => `/projects/${id}/bulk-pdf-download`,
    projectIndexPdfs: (id) => `/projects/${id}/index-pdfs`,
    projectImportZotero: (id) => `/projects/${id}/import-zotero`,
    projectAddManualArticles: (id) => `/projects/${id}/add-manual-articles`,
    settingsZotero: '/settings/zotero',
    projectUploadPdfsBulk: (id) => `/projects/${id}/upload-pdfs-bulk`,

    // Chat
    projectChatHistory: (id) => `/projects/${id}/chat/history`,
    projectChat: (id) => `/projects/${id}/chat`,
    projectScreeningDecisions: (id) => `/projects/${id}/screening-decisions`,
};,

    // Validation
    projectExtractionDecision: (projectId, extractionId) => `/projects/${projectId}/extractions/${extractionId}/decision`,
    projectCalculateKappa: (projectId) => `/projects/${projectId}/calculate-kappa`,

    // Reporting
    projectBibliography: (id, style) => `/projects/${id}/reports/bibliography?style=${style}`,
    projectSummaryTable: (id) => `/projects/${id}/reports/summary-table`,
    projectExportSummaryTable: (id) => `/projects/${id}/reports/summary-table/export/excel`,

    // RoB
    projectRob: (projectId, articleId) => `/projects/${projectId}/risk-of-bias/${articleId}`,
    projectRunRobAnalysis: (projectId) => `/projects/${projectId}/run-rob-analysis`,
};

// Messages d'√©tat
export const MESSAGES = {
    loading: 'Chargement en cours...', 
    // App
    appStart: 'üöÄ D√©marrage de AnalyLit V4.1 Frontend (Version am√©lior√©e)...',
    missingDOMElement: '√âl√©ments DOM critiques manquants:',
    errorUI: "Erreur : √©l√©ments d'interface manquants",
    appInitialized: (time) => `‚úÖ Application initialis√©e en ${time}ms`,
    initError: "‚ùå Erreur d'initialisation:",
    loadError: "Impossible de charger l'application. Rechargez la page.",
    initialDataLoaded: (time) => `üìä Donn√©es initiales charg√©es en ${time}ms`,
    initialDataError: 'Erreur chargement initial:',
    appStateLog: '√âtat de l'application:',
    debugInterface: 'üéØ Interface de debug disponible: window.AnalyLit',
    // Projets
    projectCreated: 'Projet cr√©√© avec succ√®s',
    projectDeleted: 'Projet supprim√©',
    projectNameRequired: 'Le nom du projet est requis.',
    creatingProject: 'Cr√©ation du projet...', 
    deletingProject: 'Suppression du projet...', 
    projectIdMissingForExport: "ID du projet manquant pour l'exportation.",
    projectExportStarted: "L'exportation du projet a commenc√©...",
    confirmDeleteProjectTitle: 'Confirmer la suppression',
    confirmDeleteProjectBody: (name) => `√ätes-vous s√ªr de vouloir supprimer le projet "<strong>${name}</strong>" ?`,
    // Articles
    loadingResults: 'Chargement des r√©sultats...', 
    noProjectSelected: 'Aucun projet s√©lectionn√©',
    selectProjectToViewResults: 'S√©lectionnez un projet pour voir les r√©sultats de recherche.',
    errorLoadingResults: 'Erreur de chargement des r√©sultats.',
    articleNotFound: 'Article introuvable',
    articleDetailsTitle: "D√©tails de l'article",
    noArticleSelected: 'Aucun article s√©lectionn√©',
    confirmDeleteArticles: (count) => `Supprimer ${count} article(s) s√©lectionn√©(s) ?`,
    deleteStarted: (jobId) => `Suppression lanc√©e (Job ID: ${jobId})`,
    batchProcessModalTitle: 'Lancer le Screening par Lot',
    screeningStarted: (count) => `Lancement du screening pour ${count} article(s)...`,
    screeningTaskStarted: 'T√¢che de screening lanc√©e en arri√®re-plan.',
    noArticleToExtract: "Aucun article n'a √©t√© marqu√© comme 'Inclus' pour l'extraction.",
    fullExtractionModalTitle: 'Extraction Compl√®te',
    noGridSelectedForExtraction: "Veuillez s√©lectionner une grille d'extraction",
    extractionStarted: (count) => `Lancement de l'extraction pour ${count} article(s)...`,
    extractionTaskStarted: 'Extraction compl√®te lanc√©e en arri√®re-plan.',
    noProjects: 'Aucun projet trouv√©. Cr√©ez-en un pour commencer !',
    noArticles: 'Aucun article dans ce projet.',
    noArticlesFoundTitle: 'Aucun article trouv√©',
    noArticlesFoundText: 'Lancez une recherche pour commencer √† collecter des articles.',
    // Analyses
    analysisStarted: 'Analyse lanc√©e avec succ√®s',
    selectProjectToViewAnalyses: 'S√©lectionnez un projet pour voir les analyses.',
    errorLoadingAnalyses: 'Erreur lors du chargement des analyses',
    savingPrisma: 'Sauvegarde PRISMA...', 
    prismaSaved: 'Progression PRISMA sauvegard√©e.',
    prismaExportNotImplemented: 'Export PRISMA non impl√©ment√©.',
    atnAnalysisStarted: "Lancement de l'analyse ATN...",
    atnAnalysisJobStarted: (jobId) => `Analyse ATN lanc√©e (Job ID: ${jobId})`,
    selectProjectFirst: 'Veuillez d'abord s√©lectionner un projet.',
    startingAnalysis: (type) => `Lancement de la g√©n√©ration pour ${type}...`,
    unknownAnalysisType: "Type d'analyse inconnu.",
    analysisJobStarted: (type, jobId) => `La g√©n√©ration pour ${type} a √©t√© lanc√©e (Job: ${jobId}).`,
    analysisStartedSimple: (type) => `La g√©n√©ration pour ${type} a √©t√© lanc√©e.`, 
    errorStartingAnalysis: "Erreur lors du lancement de l'analyse",
    advancedAnalysisModalTitle: 'Lancer une Analyse Avanc√©e',
    startingMetaAnalysis: 'Lancement de la m√©ta-analyse...', 
    metaAnalysisStarted: 'M√©ta-analyse lanc√©e avec succ√®s.',
    startingDescriptiveStats: 'Calcul des statistiques descriptives...', 
    descriptiveStatsStarted: 'Calcul des statistiques lanc√©.',
    selectProjectToExportAnalyses: 'Veuillez s√©lectionner un projet pour exporter les analyses.',
    preparingExport: "Pr√©paration de l'exportation...",
    analysisExportStarted: "L'exportation des analyses a commenc√©.",
    errorExportingAnalyses: "Erreur d'exportation",
    noDataForGraph: 'Aucune donn√©e pour le graphe. Lancez l'analyse pour le g√©n√©rer.',
    graphStats: (nodes, edges) => `${nodes} noeuds et ${edges} relations.`, 
    // Settings
    errorLoadingPrompts: 'Erreur chargement prompts',
    loadingSettingsData: 'Chargement des donn√©es de configuration...', 
    settingsDataNotReady: "Les donn√©es des param√®tres ne sont pas pr√™tes, le rendu est annul√©.",
    noAnalysisProfileFound: 'Aucun profil d'analyse trouv√©.',
    refreshingQueuesStatus: "Rafra√Æchissement du statut des files...",
    noPromptTemplateFound: 'Aucun mod√®le de prompt trouv√©.',
    noOllamaModelFound: 'Aucun mod√®le Ollama trouv√©',
    aceNotLoaded: "La biblioth√®que Ace n'a pas pu √™tre charg√©e.",
    aceRetry: "Ace non charg√©. Nouvel essai dans 100ms.",
    aceInitError: (type) => `Impossible d'initialiser l'√©diteur Ace pour ${type}.`,
    cannotDeleteDefaultProfile: "Impossible de supprimer le profil par d√©faut.",
    deleteThisProfile: "Supprimer ce profil",
    templateApplied: (name, type) => `Mod√®le '${name}' appliqu√© aux √©diteurs '${type}'.`,
    cannotApplyTemplate: `Impossible de d√©terminer √† quel √©diteur ce mod√®le s'applique. Veuillez s√©lectionner un onglet.`, 
    saving: 'Sauvegarde...', 
    profileSaved: (name) => `Profil '${name}' sauvegard√©.`, 
    errorSavingProfile: "Erreur lors de la sauvegarde du profil:",
    cannotDeleteProfile: "Impossible de supprimer ce profil (d√©faut ou non s√©lectionn√©).",
    confirmProfileDeleteTitle: 'Confirmer la suppression',
    confirmProfileDeleteBody: (name) => `√ätes-vous s√ªr de vouloir supprimer d√©finitivement le profil "${name}" ?`,
    deleteButton: 'Supprimer',
    profileDeleted: (name) => `Profil "${name}" supprim√©.`, 
    errorDeletingProfile: "Erreur lors de la suppression du profil:",
    clearQueueTitle: 'Vider la file d\'attente',
    confirmClearQueueBody: (name) => `√ätes-vous s√ªr de vouloir vider la file "${name}" ? Toutes les t√¢ches en attente seront perdues.`, 
    clearButton: 'Vider',
    queueCleared: (name) => `La file "${name}" a √©t√© vid√©e.`, 
    promptSaved: 'Mod√®le de prompt sauvegard√©.',
    selectNotFound: "L'√©l√©ment select 'available-models-select' est introuvable.",
    modelListNotFound: "Erreur : Impossible de trouver la liste des mod√®les.",
    modelDownloaded: (name) => `Mod√®le ${name} t√©l√©charg√© avec succ√®s`,
    unknownError: 'Erreur inconnue',
    downloadError: 'Erreur t√©l√©chargement',
    downloadingModel: (name) => `T√©l√©chargement de ${name}...`,
    noDescription: 'Pas de description.',
    chooseModel: '-- Choisir un mod√®le --',
    noWorkerDetected: 'Aucun worker actif d√©tect√©.',
    tasksNotProcessed: 'Les t√¢ches ne seront pas trait√©es.',
    profileNotFound: (id) => `Profil non trouv√©: ${id}`,
    // Grids
    errorLoadingGrids: 'Erreur lors du chargement des grilles.',
    selectProjectToViewGrids: 'S√©lectionnez un projet pour voir ses grilles.',
    noCustomGrids: 'Aucune grille personnalis√©e.',
    confirmDeleteGrid: 'Supprimer cette grille ?',
    gridDeleted: 'Grille supprim√©e.',
    editGridTitle: 'Modifier la Grille',
    createGridTitle: 'Cr√©er une Nouvelle Grille',
    invalidJsonFile: 'Veuillez s√©lectionner un fichier .json valide.',
    gridImported: 'Grille import√©e avec succ√®s.',
    gridNameAndFieldRequired: 'Le nom de la grille et au moins un champ sont requis.',
    gridSaved: (isUpdate) => `Grille ${isUpdate ? 'mise √† jour' : 'cr√©√©e'} avec succ√®s.`, 
    errorSavingGrid: 'Erreur lors de la sauvegarde de la grille',
    fieldNamePlaceholder: 'Nom du champ',
    fieldDescriptionPlaceholder: 'Description (optionnel)',
    // Core
    taskCancelRequestSent: "Demande d'annulation de la t√¢che envoy√©e.",
    taskCancelError: "Erreur lors de l'annulation",
    taskRetrySuccess: (id) => `T√¢che ${id} relanc√©e.`, 
    taskRetryError: "Erreur lors de la relance",
    socketUnavailable: 'Client Socket.IO indisponible.',
    websocketConnected: '‚úÖ WebSocket connect√©',
    websocketDisconnected: 'üîå WebSocket d√©connect√©.',
    notificationReceived: 'üîî Notification re√ßue:',
    analysisComplete: (type) => `Analyse "${type}" termin√©e.`, 
    refreshingAnalyses: 'Rafra√Æchissement de la section analyses...', 
    searchComplete: (count) => `Recherche termin√©e: ${count} articles trouv√©s.`, 
    refreshingResults: 'Rafra√Æchissement de la section r√©sultats...', 
    websocketError: 'Erreur WebSocket:',
    firstRender: (section) => `First render for section: ${section}`,
    // Search
    selectProjectForSearch: 'Veuillez s√©lectionner un projet pour commencer une recherche.',
    expertQueryRequired: 'Veuillez saisir au moins une requ√™te en mode expert.',
    queryRequired: 'Veuillez saisir une requ√™te de recherche.',
    searching: 'Recherche en cours...', 
    searchStarted: 'Recherche lanc√©e en arri√®re-plan. Les r√©sultats appara√Ætront progressivement.',
    selectProjectToSearch: 'Veuillez s√©lectionner un projet pour lancer une recherche.',
    newSearchModalTitle: 'Nouvelle Recherche',
    // Screening
    loadingScreening: 'Chargement du screening...', 
    errorLoadingScreening: 'Erreur de chargement du screening',
    selectProjectForScreening: 'S√©lectionnez un projet pour commencer le screening.',
    noArticlesToScreen: 'Aucun article √† screener. Lancez un traitement par lot.',
    // Reporting
    selectProjectForReporting: 'Veuillez s√©lectionner un projet pour acc√©der aux rapports.',
    generatingBibliography: 'G√©n√©ration de la bibliographie...', 
    bibliographyNotImplemented: 'G√©n√©ration de la bibliographie non impl√©ment√©e.',
    errorGeneratingBibliography: 'Erreur lors de la g√©n√©ration de la bibliographie.',
    generatingSummaryTable: 'G√©n√©ration du tableau de synth√®se...', 
    summaryTableNotImplemented: 'G√©n√©ration du tableau de synth√®se non impl√©ment√©e.',
    errorGeneratingSummaryTable: 'Erreur lors de la g√©n√©ration du tableau de synth√®se.',
    exportingExcel: 'Exportation du tableau en Excel...', 
    exportExcelNotImplemented: 'Exportation du tableau non impl√©ment√©e.',
    errorExportingExcel: 'Erreur lors de l\'exportation du tableau en Excel.',
    loadingPrisma: 'Chargement de la checklist PRISMA-ScR...', 
    prismaLoaded: 'Checklist PRISMA-ScR charg√©e.',
    errorLoadingPrisma: 'Erreur lors du chargement de la checklist PRISMA-ScR.',
    prismaUnavailable: 'Checklist PRISMA-ScR non disponible.',
    savingPrismaChecklist: 'Sauvegarde de la checklist PRISMA-ScR...', 
    prismaChecklistSaved: 'Checklist PRISMA-ScR sauvegard√©e avec succ√®s.',
    errorSavingPrismaChecklist: 'Erreur lors de la sauvegarde de la checklist PRISMA-ScR.',
    generatingPrismaDiagram: 'G√©n√©ration du diagramme PRISMA...', 
    prismaDiagramStarted: 'G√©n√©ration du diagramme PRISMA lanc√©e en arri√®re-plan.',
    errorGeneratingPrismaDiagram: 'Erreur lors de la g√©n√©ration du diagramme PRISMA',
    // Import
    selectProjectForImport: 'Veuillez s√©lectionner un projet pour g√©rer les imports et les fichiers.',
    pmidImportModalTitle: 'Import Manuel PMID/DOI',
    searchingFreePdfs: 'Recherche des PDFs gratuits...', 
    pdfSearchStarted: 'Recherche de PDFs lanc√©e en arri√®re-plan.',
    generatingThesisExport: 'G√©n√©ration de l\'export th√®se...', 
    startingIndexing: 'Lancement de l\'indexation...', 
    indexingInProgress: 'Indexation en cours...', 
    indexingStarted: 'Indexation lanc√©e en arri√®re-plan.',
    zoteroSyncNotImplemented: 'Synchronisation Zotero non impl√©ment√©e dans cette version.',
    selectProject: 'Veuillez s√©lectionner un projet.',
    importingZotero: 'Import du fichier Zotero...', 
    referencesImported: (count) => `${count} r√©f√©rences import√©es.`, 
    errorImportingZotero: 'Erreur lors de l\'import Zotero',
    pmidFieldNotFound: "Erreur : le champ d'import de PMID n'a pas √©t√© trouv√©.",
    identifierRequired: 'Veuillez saisir au moins un identifiant.',
    importingIds: (count) => `Import de ${count} identifiant(s)...`, 
    importStartedForIds: (count) => `Import lanc√© pour ${count} identifiant(s).`, 
    errorImporting: 'Erreur lors de la sauvegarde',
    zoteroCredentialsRequired: 'L\'ID utilisateur et la cl√© d\'API Zotero sont requis.',
    zoteroCredentialsSaved: 'Identifiants Zotero sauvegard√©s avec succ√®s.',
    errorSaving: 'Erreur lors de la sauvegarde',
    max20Pdfs: 'Maximum 20 PDFs autoris√©s par upload.',
    uploadingPdfs: (count) => `Upload de ${count} PDF(s)...`, 
    pdfsUploaded: (count) => `${count} PDFs upload√©s`, 
    errorUploading: 'Erreur lors de l\'upload',
    // RoB
    selectProjectForRob: 'S√©lectionnez un projet pour √©valuer le risque de biais.',
    noArticlesInProject: 'Aucun article dans ce projet. Lancez une recherche d\'abord.',
    editButton: '√âditer',
    runRobAnalysisButton: 'Lancer l\'analyse RoB sur la s√©lection',
    noRobAssessment: 'Aucune √©valuation de biais pour cet article. Lancez l\'analyse.',
    errorPrefix: 'Erreur:',
    robDomainRandomization: 'Randomisation:',
    robDomainMissingData: 'Donn√©es manquantes:',
    robDomainOverall: '√âvaluation globale:',
    justificationPlaceholder: 'Justification...', 
    overallJustificationPlaceholder: 'Justification globale...', 
    cancelButton: 'Annuler',
    saveButton: 'Sauvegarder',
    savingButton: 'Sauvegarde...', 
    robAssessmentSaved: '√âvaluation RoB sauvegard√©e.',
    selectAtLeastOneArticleForRob: "Veuillez s√©lectionner au moins un article pour l\'analyse RoB.",
    startingRobAnalysis: (count) => `Lancement de l\'analyse RoB pour ${count} article(s)`, 
    robAnalysisStarted: "Analyse du risque de biais lanc√©e. Les r√©sultats appara√Ætront progressivement.",
    // Chat
    errorLoadingChatMessages: 'Erreur lors du chargement des messages de chat:',
    noProjectSelectedChat: 'Aucun projet s√©lectionn√©',
    selectProjectForChat: 'S√©lectionnez un projet pour acc√©der au chat RAG.',
    chatError: 'Erreur',
    errorLoadingChat: 'Erreur lors du chargement du chat.',
    chatPlaceholder: 'Posez votre question sur les PDFs index√©s...', 
    sendButton: 'Envoyer',
    questionRequired: 'Veuillez saisir une question',
    questionSent: 'Question envoy√©e. R√©ponse en cours...', 
    errorSendingQuestion: 'Erreur lors de l\'envoi de la question:',
    errorSendingQuestionGeneric: 'Erreur lors de l\'envoi de la question',
    selectProjectForIndexing: 'Veuillez s√©lectionner un projet pour lancer l\'indexation.',
    startingPdfIndexing: 'Lancement de l\'indexation des PDFs...', 
    pdfIndexingStarted: 'Indexation des PDFs lanc√©e en arri√®re-plan.',
    errorStartingIndexing: 'Erreur lors du lancement de l\'indexation',
    // Tasks
    noTasksInProgress: 'Aucune t√¢che en cours',
    errorLoadingTasks: 'Erreur lors du chargement des t√¢ches:',
    // Theme
    themeToggleLabel: 'Changer le th√®me',
    lightMode: 'Mode clair',
    darkMode: 'Mode sombre',
    themeLabel: 'Th√®me',
    themeAuto: 'Automatique',
    themeLight: 'Clair',
    themeDark: 'Sombre',
};

export const CONFIG = {
    API_BASE_URL: 'http://localhost:8080/api',
    WEBSOCKET_URL: '/',
    LOCAL_STORAGE_LAST_SECTION: 'analylit_last_section',
    COMPACT_MODE_STORAGE: 'compactMode',
};