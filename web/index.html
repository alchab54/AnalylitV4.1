<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnalyLit v4.1 - Plateforme IA pour revues de litt√©rature scientifique</title>
    <meta name="description" content="AnalyLit v4.1 - Plateforme intelligente pour la r√©alisation de revues de litt√©rature scientifique avec IA">
    <meta name="keywords" content="revue litt√©rature, IA, recherche scientifique, m√©ta-analyse">
    <meta name="author" content="AnalyLit Team">
    
    <!-- Favicon optimis√© -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üî¨</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üî¨</text></svg>">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/style-improved.css">
    <link rel="stylesheet" href="css/enhanced-design-tokens.css">
    
    <!-- Correction UX critique -->
    <link rel="stylesheet" href="css/ux-fix.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Scripts externes -->
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.33.0/ace.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js" defer></script>
</head>
<body>
    <!-- En-t√™te principal -->
    <header class="app-header">
        <div class="container">
            <div class="app-header__content">
                <div class="app-header__left">
                    <h1 class="app-header__title">
                        <span class="app-header__icon" role="img" aria-label="Microscope">üî¨</span>
                        AnalyLit v4.1
                        <span class="app-header__subtitle">Plateforme IA pour revues scientifiques</span>
                    </h1>
                </div>
                <div class="app-header__right">
                    <!-- Le bouton de th√®me sera ajout√© dynamiquement -->
                    <div class="connection-status" role="status" aria-live="polite">
                        <span>Connexion:</span>
                        <span data-connection-status aria-label="√âtat de connexion">‚è≥</span>
                    </div>
                    <button class="notification-indicator" style="display: none;" aria-label="Notifications">
                        <span role="img" aria-hidden="true">üì¢</span>
                        <span>Notifications</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation principale -->
    <nav class="app-nav" role="navigation" aria-label="Navigation principale">
        <div class="container">
            <ul class="app-nav__list" role="list">
                <li class="app-nav__item" role="listitem">
                    <button class="app-nav__button app-nav__button--active" 
                            data-action="show-section" 
                            data-section-id="projects"
                            aria-current="page">
                        <span role="img" aria-hidden="true">üìÅ</span> Projets
                    </button>
                </li>
                <li class="app-nav__item" role="listitem">
                    <button class="app-nav__button" 
                            data-action="show-section" 
                            data-section-id="search"
                            title="Raccourci: Ctrl+K">
                        <span role="img" aria-hidden="true">üîç</span> Recherche
                    </button>
                </li>
                <li class="app-nav__item" role="listitem">
                    <button class="app-nav__button" data-action="show-section" data-section-id="results">
                        <span role="img" aria-hidden="true">üìÑ</span> R√©sultats
                    </button>
                </li>
                <li class="app-nav__item" role="listitem">
                    <button class="app-nav__button" data-action="show-section" data-section-id="validation">
                        <span role="img" aria-hidden="true">‚öñÔ∏è</span> Validation
                    </button>
                </li>
                <li class="app-nav__item" role="listitem">
                    <button class="app-nav__button" data-action="show-section" data-section-id="grids">
                        <span role="img" aria-hidden="true">üìã</span> Grilles
                    </button>
                </li>
                <li class="app-nav__item" role="listitem">
                    <button class="app-nav__button" data-action="show-section" data-section-id="rob">
                        <span role="img" aria-hidden="true">‚ö†Ô∏è</span> Risque de Biais
                    </button>
                </li>
                <li class="app-nav__item" role="listitem">
                    <button class="app-nav__button" data-action="show-section" data-section-id="analyses">
                        <span role="img" aria-hidden="true">üìä</span> Analyses
                    </button>
                </li>
                <li class="app-nav__item" role="listitem">
                    <button class="app-nav__button" data-action="show-section" data-section-id="import">
                        <span role="img" aria-hidden="true">üìö</span> Import & Fichiers
                    </button>
                </li>
                <li class="app-nav__item" role="listitem">
                    <button class="app-nav__button" data-action="show-section" data-section-id="chat">
                        <span role="img" aria-hidden="true">üí¨</span> Chat
                    </button>
                </li>
                <li class="app-nav__item" role="listitem">
                    <button class="app-nav__button" data-action="show-section" data-section-id="settings">
                        <span role="img" aria-hidden="true">‚öôÔ∏è</span> Param√®tres
                    </button>
                </li>
                <li class="app-nav__item" role="listitem">
                    <button class="app-nav__button" data-action="show-section" data-section-id="tasks">
                        <span role="img" aria-hidden="true">‚è≥</span> T√¢ches
                    </button>
                </li>
                <li class="app-nav__item" role="listitem">
                    <button class="app-nav__button" data-action="show-section" data-section-id="reporting">
                        <span role="img" aria-hidden="true">üìë</span> Rapports
                    </button>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Contenu principal -->
    <main class="app-main" role="main">
        <div class="container">
            <!-- Section Projets -->
            <section class="section section--active" data-section="projects" aria-labelledby="projects-title">
                <div class="section-header">
                    <div class="section-header__content">
                        <h2 id="projects-title">Projets</h2>
                        <p>Cr√©ez et g√©rez vos projets de revue de litt√©rature. Chaque projet organise vos recherches, analyses et r√©sultats.</p>
                    </div>
                    <div class="section-header__actions">
                        <button class="btn btn--primary" 
                                id="createProjectBtn" 
                                data-action="create-project-modal"
                                aria-describedby="projects-title">
                            <span role="img" aria-hidden="true">‚ûï</span> Nouveau projet
                        </button>
                    </div>
                </div>

                <div class="projects-container">
                    <div class="projects-grid" id="projectsList" role="region" aria-label="Liste des projets">
                        <!-- Liste des projets g√©n√©r√©e dynamiquement -->
                    </div>
                </div>

                <!-- D√©tails du projet s√©lectionn√© -->
                <div class="project-detail" id="projectDetail">
                    <div class="card">
                        <div class="card__header">
                            <h3>D√©tails du projet</h3>
                        </div>
                        <div class="card__body" id="projectDetailContent">
                            <p>S√©lectionnez un projet pour voir ses d√©tails et m√©triques.</p>
                        </div>
                    </div>
                    <div id="projectPlaceholder" class="project-placeholder text-center">
                        <div class="project-placeholder__icon" role="img" aria-hidden="true">üìÅ</div>
                        <h3>Aucun projet s√©lectionn√©</h3>
                        <p>S√©lectionnez un projet dans la liste ci-dessus ou cr√©ez-en un nouveau pour commencer.</p>
                    </div>
                </div>
            </section>

            <!-- Section Recherche -->
            <section class="section" data-section="search" aria-labelledby="search-title">
                <div id="searchContainer">
                    <!-- Contenu g√©n√©r√© dynamiquement -->
                </div>
            </section>

            <!-- Section R√©sultats -->
            <section class="section" data-section="results" aria-labelledby="results-title">
                <div class="section-header">
                    <div class="section-header__content">
                        <h2 id="results-title">R√©sultats de recherche</h2>
                        <p>Consultez, filtrez et validez les articles trouv√©s lors de vos recherches bibliographiques.</p>
                    </div>
                    <div class="section-header__actions">
                        <button class="btn btn--primary" data-action="show-search-modal">
                            <span role="img" aria-hidden="true">üîç</span> Nouvelle recherche
                        </button>
                    </div>
                </div>
                <div class="results-container" id="resultsContainer">
                    <div class="results-placeholder text-center">
                        <div class="results-placeholder__icon" role="img" aria-hidden="true">üìÑ</div>
                        <h3>Aucun r√©sultat</h3>
                        <p>Lancez une recherche pour afficher les articles trouv√©s ici.</p>
                    </div>
                </div>
            </section>

            <!-- Section Validation -->
            <section class="section" data-section="validation" aria-labelledby="validation-title">
                <div class="section-header">
                    <div class="section-header__content">
                        <h2 id="validation-title">Validation Inter-√âvaluateurs</h2>
                        <p>Validez la s√©lection des articles selon vos crit√®res d'inclusion/exclusion. Calculez les m√©triques de concordance.</p>
                    </div>
                    <div class="section-header__actions">
                        <button class="btn btn--primary" data-action="run-extraction-modal">
                            <span role="img" aria-hidden="true">üöÄ</span> Lancer l'extraction
                        </button>
                    </div>
                </div>
                <div id="validationContainer">
                    <div class="validation-placeholder text-center">
                        <span class="validation-placeholder__icon" role="img" aria-hidden="true">‚öñÔ∏è</span>
                        <h3>Aucun projet s√©lectionn√©</h3>
                        <p>S√©lectionnez un projet pour acc√©der √† la validation des r√©sultats.</p>
                    </div>
                </div>
            </section>

            <!-- Section Grilles -->
            <section class="section" data-section="grids" aria-labelledby="grids-title">
                <div class="section-header">
                    <div class="section-header__content">
                        <h2 id="grids-title">Grilles d'Extraction</h2>
                        <p>D√©finissez les donn√©es √† extraire de chaque article selon vos objectifs de recherche.</p>
                    </div>
                    <div class="section-header__actions">
                        <button class="btn btn--primary" data-action="create-grid-modal">
                            <span role="img" aria-hidden="true">üìã</span> Nouvelle Grille
                        </button>
                        <button class="btn btn--secondary" data-action="triggerGridImport">
                            <span role="img" aria-hidden="true">üì•</span> Importer
                        </button>
                        <input type="file" id="grid-import-input" accept=".json" style="display: none;" aria-hidden="true" />
                    </div>
                </div>
                <div id="gridsContainer">
                    <!-- Contenu g√©n√©r√© dynamiquement -->
                </div>
            </section>

            <!-- Section Risque de Biais -->
            <section class="section" data-section="rob" aria-labelledby="rob-title">
                <div class="section-header">
                    <div class="section-header__content">
                        <h2 id="rob-title">√âvaluation du Risque de Biais</h2>
                        <p>√âvaluez la qualit√© m√©thodologique et le risque de biais des √©tudes incluses dans votre revue.</p>
                    </div>
                </div>
                <div id="robContainer">
                    <!-- Contenu g√©n√©r√© dynamiquement -->
                </div>
            </section>

            <!-- Section Analyses -->
            <section class="section" data-section="analyses" aria-labelledby="analyses-title">
                <div class="section-header">
                    <div class="section-header__content">
                        <h2 id="analyses-title">Analyses Avanc√©es</h2>
                        <p>G√©n√©rez des analyses statistiques, m√©ta-analyses, graphiques de connaissances et synth√®ses narratives.</p>
                    </div>
                    <div class="section-header__actions">
                        <button class="btn btn--primary" data-action="show-run-analysis-modal">
                            <span role="img" aria-hidden="true">üìä</span> Nouvelle analyse
                        </button>
                    </div>
                </div>
                <div class="analysis-grid" id="analysisContainer">
                    <div id="knowledgeGraphContainer" 
                         style="width: 100%; height: 600px; border: 1px solid var(--color-border); border-radius: var(--radius-xl);"
                         role="img" 
                         aria-label="Graphique de connaissances">
                    </div>
                </div>
            </section>

            <!-- Section Import & Fichiers -->
            <section class="section" data-section="import" aria-labelledby="import-title">
                <div class="section-header">
                    <div class="section-header__content">
                        <h2 id="import-title">Import & Gestion des Fichiers</h2>
                        <p>Importez vos r√©f√©rences depuis Zotero, ajoutez des PDFs et indexez le contenu pour le chat IA.</p>
                    </div>
                </div>
                <div class="import-sections" id="importContainer">
                    <!-- Contenu g√©n√©r√© dynamiquement -->
                </div>
            </section>

            <!-- Section Chat -->
            <section class="section" data-section="chat" aria-labelledby="chat-title">
                <div class="section-header">
                    <div class="section-header__content">
                        <h2 id="chat-title">Chat IA avec vos Documents</h2>
                        <p>Posez des questions sur le contenu de vos PDFs index√©s. L'IA analyse et r√©pond en se basant sur vos documents.</p>
                    </div>
                </div>
                <div class="chat-interface" id="chatContainer">
                    <div class="chat-messages" id="chat-messages" role="log" aria-live="polite" aria-label="Messages du chat">
                        <div class="chat-welcome text-center">
                            <div class="chat-welcome__icon" role="img" aria-hidden="true">üí¨</div>
                            <h3>Chat IA avec vos Documents</h3>
                            <p>Indexez vos PDFs puis posez des questions sur leur contenu.</p>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <textarea id="chatInput" 
                                  class="form-control chat-input-field" 
                                  placeholder="Posez une question sur les documents du projet..." 
                                  data-action="submit-chat-on-enter"
                                  rows="3"
                                  aria-label="Message √† envoyer"></textarea>
                        <button class="btn btn--primary" data-action="send-chat-message" aria-label="Envoyer le message">
                            <span role="img" aria-hidden="true">üì§</span> Envoyer
                        </button>
                    </div>
                </div>
            </section>

            <!-- Section Param√®tres -->
            <section class="section" data-section="settings" aria-labelledby="settings-title">
                <div class="section-header">
                    <div class="section-header__content">
                        <h2 id="settings-title">Param√®tres & Configuration</h2>
                        <p>Configurez vos profils d'analyse, mod√®les IA, prompts personnalis√©s et pr√©f√©rences de l'application.</p>
                    </div>
                </div>
                <div class="settings-grid" id="settingsContainer">
                    <!-- Structure g√©n√©r√©e dynamiquement par settings.js -->
                    <div class="card">
                        <div class="card__header">
                            <h3>Pr√©f√©rences d'Interface</h3>
                        </div>
                        <div class="card__body">
                            <div id="theme-selector-container">
                                <!-- Le s√©lecteur de th√®me sera ajout√© ici -->
                            </div>
                            <div class="form-group form-group--checkbox">
                                <input type="checkbox" id="compact-mode-toggle" data-action="toggle-compact-mode">
                                <label for="compact-mode-toggle">
                                    <strong>Mode Compact</strong>
                                    <small>R√©duit les espacements pour une vue plus dense.</small>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section T√¢ches -->
            <section class="section" data-section="tasks" aria-labelledby="tasks-title">
                <div class="section-header">
                    <div class="section-header__content">
                        <h2 id="tasks-title">T√¢ches en Arri√®re-Plan</h2>
                        <p>Suivez l'√©tat des op√©rations longues : analyses, indexations, extractions de donn√©es.</p>
                    </div>
                </div>
                <div id="tasksContainer" class="tasks-section-container">
                    <!-- Le contenu est inject√© par tasks.js -->
                    <div class="placeholder">
                        <div class="placeholder-icon">‚è≥</div>
                        <h3>Chargement des t√¢ches...</h3>
                        <p>R√©cup√©ration de l'√©tat des op√©rations en cours.</p>
                    </div>
                    <!-- Contenu g√©n√©r√© dynamiquement -->
                </div>
            </section>

            <!-- Section Rapports -->
            <section class="section" data-section="reporting" aria-labelledby="reporting-title">
                <div class="section-header">
                    <div class="section-header__content">
                        <h2 id="reporting-title">Rapports & Exports</h2>
                        <p>G√©n√©rez des bibliographies, tableaux de synth√®se et exports pour votre manuscrit de th√®se.</p>
                    </div>
                </div>
                <div id="reportingContainer" class="reporting-grid">
                    <!-- Contenu g√©n√©r√© dynamiquement -->
                </div>
            </section>
        </div>
    </main>

    <!-- √âl√©ments cach√©s pour les uploads -->
    <input type="file" id="zoteroFileInput" accept=".json" style="display: none;" aria-hidden="true">
    <input type="file" id="bulkPDFInput" multiple accept=".pdf" style="display: none;" aria-hidden="true">
    <input type="file" id="manualPDFInput" multiple accept=".pdf" style="display: none;" aria-hidden="true">

    <!-- Overlay de chargement -->
    <div class="loading-overlay" id="loadingOverlay" role="dialog" aria-modal="true" aria-labelledby="loading-message">
        <div class="loading-overlay__content">
            <div class="loading-spinner loading-spinner--lg" role="status" aria-hidden="true"></div>
            <p class="loading-overlay__message" id="loading-message">Chargement...</p>
            <div class="progress-bar-container" style="display: none;">
                <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
            <button id="cancelTaskBtn" class="btn btn--secondary btn--sm" style="display: none;" data-action="cancel-task">
                Annuler l'op√©ration
            </button>
        </div>
    </div>

    <!-- Conteneur des notifications toast -->
    <div class="toast-container" id="toastContainer" aria-live="polite" aria-label="Notifications">
        <!-- Toasts g√©n√©r√©s dynamiquement -->
    </div>

    <!-- Conteneur pour toutes les modales -->
    <div id="modalsContainer">
        <!-- Modales g√©n√©r√©es dynamiquement par les modules JS -->
    </div>

    <!-- CORRECTION : Mise √† jour des data-attributes -->
    <div class="task-monitor" id="task-monitor">
        <div class="task-counter">
            <span id="jobs-count">0</span> t√¢ches actives
        </div>
        <div class="task-progress" id="job-progress" style="display:none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <span class="progress-text" id="progress-text">0%</span>
        </div>
    </div>

    <!-- Scripts JavaScript -->
    <!-- Migration script for data-task-id to data-job-id -->
    <script type="module" src="/js/migration-fix.js"></script>
    <script type="module">
        import { migrateTaskReferences } from './js/migration-fix.js';
        document.addEventListener('DOMContentLoaded', migrateTaskReferences);
    </script>

    <!-- Temporary test script for frontend fixes -->
    <script type="module" src="/js/tests/test_frontend_fixes.js"></script>

    <!-- Main application entry point -->
    <script type="module" src="/js/app-improved.js"></script>

    <!-- Service Worker pour PWA (optionnel) -->
    <script>
        // if ('serviceWorker' in navigator) {
        //     window.addEventListener('load', function() {
        //         navigator.serviceWorker.register('/sw.js').then(function(registration) {
        //             console.log('SW registered: ', registration);
        //         }).catch(function(registrationError) {
        //             console.log('SW registration failed: ', registrationError);
        //         });
        //     });
        // }
    </script>

    <!-- Schema.org structured data pour SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "AnalyLit v4.1",
        "description": "Plateforme intelligente pour la r√©alisation de revues de litt√©rature scientifique avec IA",
        "applicationCategory": "ThesisApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        }
    }
    </script>
</body>
</html>